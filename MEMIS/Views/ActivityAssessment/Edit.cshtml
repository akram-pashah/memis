@model MEMIS.Models.EditActivityAssessmentDto

@{
    ViewData["Title"] = "Edit";
    Layout = "~/Pages/Shared/_ContentNavbarLayout.cshtml";
}

<div class="card">
    <div class="card-header">
        <h1>Edit</h1>
        <h4>Activity Assessment</h4>
    </div>
    <hr />
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <form asp-action="Edit" method="post">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <input type="hidden" asp-for="intDeptPlan" />

                    <div class="form-group">
                        <label asp-for="strategicIntervention" class="control-label"></label>
                        <input type="text" asp-for="strategicIntervention" disabled class="form-control" />
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="StrategicAction" class="control-label"></label>
                        <input type="text" asp-for="StrategicAction" disabled class="form-control" />
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="strategicObjective" class="control-label"></label>
                        <input type="text" asp-for="strategicObjective" disabled class="form-control" />
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="activity" class="control-label"></label>
                        <input asp-for="activity" disabled class="form-control" />
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="outputIndicator" class="control-label"></label>
                        <input asp-for="outputIndicator" class="form-control" />
                        <span asp-validation-for="outputIndicator" class="text-danger"></span>
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="baseline" class="control-label"></label>
                        <input asp-for="baseline" type="number" class="form-control" />
                        <span asp-validation-for="baseline" class="text-danger"></span>
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="budgetCode" class="control-label"></label>
                        <input asp-for="budgetCode" type="number" class="form-control" />
                        <span asp-validation-for="budgetCode" class="text-danger"></span>
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="comparativeTarget" class="control-label"></label>
                        <input asp-for="comparativeTarget" type="number" class="form-control" />
                        <span asp-validation-for="comparativeTarget" class="text-danger"></span>
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="justification" class="control-label"></label>
                        <input asp-for="justification" class="form-control" />
                        <span asp-validation-for="justification" class="text-danger"></span>
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="budgetAmount" class="control-label"></label>
                        <input asp-for="budgetAmount" type="number" class="form-control" />
                        <span asp-validation-for="budgetAmount" class="text-danger"></span>
                    </div>
                    <br />

                    <div class="form-group">
                        <div class="input-group">
                            <div class="col">
                                <select id="Quarter" class="form-control" asp-items="ViewBag.Quarter"></select>
                                <span id="quarterValidation" class="text-danger"></span>
                            </div>
                            <div class="col">
                                <input id="QTarget" class="form-control" type="number" />
                                <span asp-validation-for="Q1Target" class="text-danger"></span>
                            </div>
                            <div class="col">
                                <input id="QBudget" class="form-control" type="number" />
                                <span asp-validation-for="Q1Budget" class="text-danger"></span>
                            </div>
                            <div class="col">
                                <input id="QActual" class="form-control" type="number" />
                                <span asp-validation-for="Q1Actual" class="text-danger"></span>
                            </div>
                            <div class="col">
                                <input id="QAmtSpent" class="form-control" type="number" />
                                <span asp-validation-for="Q1AmtSpent" class="text-danger"></span>
                            </div>
                            <div class="col">
                                <input id="QAchievement" class="form-control" type="number" />
                            </div>
                            <div class="col">
                                <input id="QJustification" class="form-control" />
                                <span asp-validation-for="Q1Justification" class="text-danger"></span>
                            </div>
                            <div class="col-auto align-self-end">
                                <button type="button" class="btn btn-outline-primary" onclick="addQuarterDetails()">
                                    <i class="bx bx-plus-circle"></i>
                                </button>
                                <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#accordionQuarterDetailsCollapse" aria-expanded="false" aria-controls="accordionQuarterDetailsCollapse">
                                    <i class="bx bx-collapse-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="accordion" id="accordionQuarterDetails">
                            <div class="card accordion-item">
                                <div id="accordionQuarterDetailsCollapse" class="accordion-collapse" data-bs-parent="#accordionQuarterDetails">
                                    <div class="accordion-body">
                                        <table class="table table-striped table-bordered" id="quarterDetailsTable">
                                            <thead class="thead-dark">
                                                <tr>
                                                    <th>Id</th>
                                                    <th>Quarter</th>
                                                    <th>Target</th>
                                                    <th>Budget</th>
                                                    <th>Actual</th>
                                                    <th>Amt Spent</th>
                                                    <th>Achievement</th>
                                                    <th>Justification</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @for (int i = 0; i < Model.QuaterlyPlans.Count; i++)
                                                {
                                                    <tr>
                                                        <td>
                                                            @(i + 1)
                                                            <input asp-for="QuaterlyPlans[i].Id" class="form-control" hidden />
                                                            <input asp-for="QuaterlyPlans[i].DeptPlanId" class="form-control" hidden />
                                                            <input asp-for="QuaterlyPlans[i].ActivityAccessId" class="form-control" hidden />
                                                            <input asp-for="QuaterlyPlans[i].ActivityAssessmentId" class="form-control" hidden />
                                                        </td>
                                                        <td>
                                                            <select asp-for="QuaterlyPlans[i].Quarter" class="form-control" asp-items="ViewBag.Quarter"></select>
                                                        </td>
                                                        <td>
                                                            <input asp-for="QuaterlyPlans[i].QTarget" class="form-control" />
                                                        </td>
                                                        <td>
                                                            <input asp-for="QuaterlyPlans[i].QBudget" class="form-control" />
                                                        </td>
                                                        <td>
                                                            <input asp-for="QuaterlyPlans[i].QActual" class="form-control" />
                                                        </td>
                                                        <td>
                                                            <input asp-for="QuaterlyPlans[i].QAmtSpent" class="form-control" />
                                                        </td>
                                                        <td>
                                                            <input asp-for="QuaterlyPlans[i].QAchievement" class="form-control" />
                                                        </td>
                                                        <td>
                                                            <input asp-for="QuaterlyPlans[i].QJustification" class="form-control" />
                                                        </td>
                                                        <td>
                                                            <button type="button" class="btn btn-danger delete-btn" onclick="removeQuarterDetails(this)" data-toggle="tooltip" data-placement="top" title="Delete">
                                                                <i class="bx bx-message-square-x"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="TotAmtSpent" class="control-label"></label>
                        <input asp-for="TotAmtSpent" type="number" class="form-control" />
                        <span asp-validation-for="TotAmtSpent" class="text-danger"></span>
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="ImpStatusId" class="control-label"></label>
                        <select asp-for="ImpStatusId" class="form-select" asp-items="ViewBag.ImpStatusId"></select>
                        <span asp-validation-for="ImpStatusId" class="text-danger"></span>
                    </div>
                    <br />
                    <div class="form-group">
                        <label asp-for="AnnualJustification" class="control-label"></label>
                        <input asp-for="AnnualJustification" class="form-control" />
                        <span asp-validation-for="AnnualJustification" class="text-danger"></span>
                    </div>
                    <br />
                    <div class="form-group">
                        <input type="submit" value="Save" class="btn btn-primary" />
                        <a asp-action="Index" class="btn btn-secondary">Back to List</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function addQuarterDetails() {
            const quarter = document.getElementById('Quarter').value;
            const target = document.getElementById('QTarget').value;
            const budget = document.getElementById('QBudget').value;
            const actual = document.getElementById('QActual').value;
            const amtSpent = document.getElementById('QAmtSpent').value;
            const achievement = document.getElementById('QAchievement').value;
            const justification = document.getElementById('QJustification').value;

            if (!quarter || !target || !budget || !actual || !amtSpent || !achievement || !justification) {
                document.getElementById('quarterValidation').textContent = 'Please fill in all fields.';
                return;
            }

            const table = document.getElementById('quarterDetailsTable').getElementsByTagName('tbody')[0];
            const rowCount = table.rows.length;
            const newRow = table.insertRow(rowCount);

            newRow.innerHTML = `
                        <td>${rowCount + 1}
                            <input name="QuaterlyPlans[${rowCount}].Id" type="hidden" />
                            <input name="QuaterlyPlans[${rowCount}].DeptPlanId" type="hidden" />
                            <input name="QuaterlyPlans[${rowCount}].ActivityAccessId" type="hidden" />
                            <input name="QuaterlyPlans[${rowCount}].ActivityAssessmentId" type="hidden" />
                        </td>
                        <td><select name="QuaterlyPlans[${rowCount}].Quarter" class="form-control" asp-items="ViewBag.Quarter">${quarter}</select></td>
                        <td><input name="QuaterlyPlans[${rowCount}].QTarget" value="${target}" class="form-control" /></td>
                        <td><input name="QuaterlyPlans[${rowCount}].QBudget" value="${budget}" class="form-control" /></td>
                        <td><input name="QuaterlyPlans[${rowCount}].QActual" value="${actual}" class="form-control" /></td>
                        <td><input name="QuaterlyPlans[${rowCount}].QAmtSpent" value="${amtSpent}" class="form-control" /></td>
                        <td><input name="QuaterlyPlans[${rowCount}].QAchievement" value="${achievement}" class="form-control" /></td>
                        <td><input name="QuaterlyPlans[${rowCount}].QJustification" value="${justification}" class="form-control" /></td>
                        <td><button type="button" class="btn btn-danger delete-btn" onclick="removeQuarterDetails(this)" data-toggle="tooltip" data-placement="top" title="Delete"><i class="bx bx-message-square-x"></i></button></td>
                    `;

            // Clear the form fields after adding
            document.getElementById('Quarter').value = '';
            document.getElementById('QTarget').value = '';
            document.getElementById('QBudget').value = '';
            document.getElementById('QActual').value = '';
            document.getElementById('QAmtSpent').value = '';
            document.getElementById('QAchievement').value = '';
            document.getElementById('QJustification').value = '';
            document.getElementById('quarterValidation').textContent = '';
        }

        function removeQuarterDetails(btn) {
            const row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
            updateRowNumbers();
        }

        function updateRowNumbers() {
            const table = document.getElementById('quarterDetailsTable').getElementsByTagName('tbody')[0];
            Array.from(table.rows).forEach((row, index) => {
                row.cells[0].innerHTML = `${index + 1}
                            <input name="QuaterlyPlans[${index}].Id" type="hidden" />
                            <input name="QuaterlyPlans[${index}].DeptPlanId" type="hidden" />
                            <input name="QuaterlyPlans[${index}].ActivityAccessId" type="hidden" />
                            <input name="QuaterlyPlans[${index}].ActivityAssessmentId" type="hidden" />
                        `;
            });
        }
    </script>
}
